== Xenosky v. 0.33 - программа для генерации инопланетных пейзажей ==

=== Описание ===

На данный момент программа строит изображение неба, хотя в дальнейшем планируется добавить также рисование ландшафтов и воды. Уникальность программы в том, что получаемые ею изображения базируются на физических законах: излучение звезды задается в виде спектра с шагом около 10 нм, затем вычисляется, сколько света рассеивается атмосферой на разных длинах волн, и лишь на заключительном этапе спектр излучения переводится в RGB, чтобы изобразить его не мониторе. Мало того, в логе содержится информация об освещенности, которую дает светило и сколько доходит до поверхности планеты, так что с помощью этой программы можно даже посчитать, сколько солнечной энергии могут получать марсоходы Spirit и Opportunity! Впрочем, для этого нужна точная модель атмосферы Марса. 

На данный момент с хорошей точностью можно смоделировать лишь атмосферу, сходную с земной. Для другого газового состава или заметно другой плотности данные могут значительно расходиться с реальностью. Причиной тому - использованная из <a href="#bib1">[1]</a> параметрическая модель, "заточенная" как раз под земную атмосферу. В дальнейшем планируется вместо нее честно расчитывать прохождение лучей через атмосферу, хотя это может оказаться чрезвычайно ресурсоемким процессом.

В целом программа еще очень сырая, очень хочется добавить в нее новые возможности и исправить наиболее откровенные ляпы (очень странная перспектива, в которой горизонт изгибается в обратную сторону). Но уже сейчас есть на что посмотреть.

Приятного пользования! Свои замечания и предложения оставляйте на <a href="mailto:nabbla@yandex.ru">nabbla@yandex.ru</a>

<h2 align="center">История изменений</h2>


<p><b>v. 0.33 (19.03.12)</b> Небольшие доработки:
<ul>
<li>Спектр светила у поверхности планеты можно сохранить в файл. Также можно сохранить в виде картинки сам график.
<li>Немного доработана процедура рисования небесных тел: теперь при малых разрешениях они не выглядят квадратами, края выходят более гладкими. Однако в скором времени взамен этой процедуры будет реализована полноценная цветная дифракция.
<li>Исправлена небольшая ошибка при оценке цвета атмосферы - теперь при спектральных классах, отличных от солнечного, цвет будет считаться точнее, но все же сильно ему доверять не стоит. В проекте - модель атмосферы с одинарным рассеянием.
<li>исправлена ошибка, которой не было в v. 0.30-0.31, но возникшая в v. 032, с неправильным вычислением яркости и освещенности у поверхности планеты
<li>при включении программы и после редактирования небесного тела по умолчанию выбирается первое небесное тело в списке (раньше выделение вовсе снималось)
<li>при добавлении нового небесного тела сразу вызывается диалог для его редактирования. Если нажать Cancel, небесное тело не добавляется.
<li>окно программы теперь нельзя уменьшить до такой степени, чтобы какие-то элементы управления пропали - оно вернется к минимальному размеру.
</ul>


<p><b>v. 0.32 (19.02.12)</b> Небольшие доработки:
<ul>
<li>Исправлен глюк, когда с некоторыми спектрами получаются очень странные, перенасыщенные изображения
<li>Сделана примитивная иконка для программы взамен стандартной
<li>Во вкладке "графики" теперь строятся графики для выбранного в списке выше небесного тела
</ul>


<p><b>v. 0.31 (16.02.12)</b> Небольшие доработки:
<ul>
<li>Наконец при расчете атмосферы учитываются все светила, а не только первое по списку. 
<li>Файлы x_vs_lambda.txt, y_vs_lambda.txt, z_vs_lambda.txt убраны куда подальше из корневой папки программы
<li>Из релиза убрана высококачественная фотография Луны - предполагалось, что можно будет изображать Луну и другие светила не просто светящимся диском, а используя фотографии, но пока такая возможность не реализована.
<li>теперь небесные тела могут иметь нулевой угловой размер - их будет на одну угловую секунду "размазывать" искажения волнового фронта, неизбежные при прохождении через атмосферу. 
</ul>
<p><b>v. 0.30 (14.02.12)</b> Программа фактически была написана заново!
<ul>
<li>Вместо одного светила можно задавать сколько угодно. Указывается их звездная величина, угловой размер и положение на небе. Также можно загружать картинку, дать название и краткое описание, хотя пока эта информация никуда не идет.
<li>Введена подробная модель атмосферы, правда, за свою основу берущая атмосферу Земли. Можно задать плотность отн. земной, закон изменения "атмосферной массы" от угла светила к зениту (см в разделе "свойства атмосферы"), содержание озона и водяных паров (практически единственные из газов в нашей атмосфере, имеющие пики поглощения в видимой области. Остальные рассеивают по Релею). Также введен параметр "затуманенность" (Turbidity). Он характеризует, во сколько раз суммарное рассеяние выше релеевской компоненты.
<p>На основание этих данных расчитывается, сколько света рассеивается в атмосфере при данном положении светила, что позволяет увидеть ярко-желтое Солнце в зените и багрово-красное на закате. Кроме того, в логе записывается освещенность у поверхности планеты. 
<li>Введены фрактальные облака.
<li>Сделаны первые попытки смоделировать процесс получения изображения подобно тому, как это делается в человеческом глазу или в фотоаппарате: выставление экспозиции по некоторому среднему значению, паразитная засветка "оптической системы" солнечными лучами, что снижает общую контрастность изображения, а также, в зачаточном состоянии - картина дифракции ярких источников света. Предстоит еще серьезно поработать над этими аспектами.
</ul>
<p><b> v. 0.03 (21.12.11)</b> Небольшие доработки: 
<ul>
<li>новая библиотека работы с табличными файлами
<li>изображаются не только графики, но и линии спектра
</ul>
<p><b> v. 0.02 (09.12.11)</b> Небольшие доработки:
<ul>
<li>можно сохранять в текстовый файл все 3 кривые, а также сохранить график как картинку.
</ul>
<p><b> v. 0.01 (03.11.11)</b> Самая первая версия. Кружок одного цвета на фоне прямоугольника другого цвета. Фактически, это тестовая программа, чтобы проверить работу colorimetry_lib, которая произвольный спектр преобразует в цвет, представленный в координатах CIE 1931 (XYZ) или привычном нам RGB.

<h2 align="center">Справочный материал по программе</h2>
<h3 align="center">Небесные тела</h3>
<p>В этой вкладке можно добавить почти неограниченное количество небесных тел. Каждое из них характеризуется следующими параметрами:
<ul>
<li>Название - будет фигурировать в списке, а в дальнейшем - в сохраненном файле (пока не сделано). На генерацию никак не влияет, чисто для себя, чтобы не запутаться
<li>Описание - то же самое. 
<li>Звездная величина - здесь подразумевается визуальная звездная величина. Чем она выше, тем тусклее объект. Увеличение зв. величины на 1 означает уменьшение яркости примерно в 2.5 раза. См <a href="http://ru.wikipedia.org/wiki/%D0%97%D0%B2%D0%B5%D0%B7%D0%B4%D0%BD%D0%B0%D1%8F_%D0%B2%D0%B5%D0%BB%D0%B8%D1%87%D0%B8%D0%BD%D0%B0">w: Звездная величина</a>, там же можно найти значения для Солнца и планет. 
<li>Файл спектра: надо загрузить таблицу с парами "длина волны - отн. мощность излучения в данном диапазоне". В папке data/spectra даются спектры Солнца, Луны и планет, в data/spectra/black_body_radiator - идеализированные кривые излучения абсолютно черного тела с температурой, соотв. указанным спектральным классам. В data/spectra/OBAFGKM - реальные спектры звезд разных спектральных классов. Там пока очень мало, к сожалению. Спектры можно построить и самостоятельно, структура файла чрезвычайно проста. Подробнее см. в описании table_func_lib (пока не готово).
<li>Угол над горизонтом (он же - угол места) и азимут - см <a href="http://ru.wikipedia.org/wiki/%D0%93%D0%BE%D1%80%D0%B8%D0%B7%D0%BE%D0%BD%D1%82%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0_%D0%BA%D0%BE%D0%BE%D1%80%D0%B4%D0%B8%D0%BD%D0%B0%D1%82">w: Горизонтальная система координат</a>
<li>Угловой размер - определяет ширину диска на экране. Ни в коем случае нельзя оставлять нулевым - программа выдаст "деление на ноль"! Да, эта программа предпочитает гильбертовы пространства и с дельта-функциями не дружит...
<li>Изображение - пока ни на что не влияет.  
</ul>
<h3 align="center">Параметры атмосферы</h3>
<p>Сейчас облака настраиваются обособленно от всего остального. В дальнейшем настройки будут несколько перекомпонованы. Итак, собственно параметры атмосферы:
<ul>
<li>Атмосферная масса - см. <a href="http://en.wikipedia.org/wiki/Air_mass_%28solar_energy%29">w: Air mass (solar energy)</a>. Если кратко - это отношение пути, пройденного лучами солнца, к кратчайшему пути, который достигается, если свет идет ровно с зенита. Хотя более точно говорить не о пройденном пути, а о количестве частиц, попавшихся на пути. Т.е атмосферная масса зависит от угла Солнца к зениту: она равна 1, когда солнце в зените, около 2, при угле в 60 градусов и около 40 при 90 градусов. Именно поэтому закаты такие багровые.
<p>зависимость атмосферной массы от угла хорошо известна для земной атмосферы, но может отличаться на других планетах. Поэтому есть возможность загрузить другую функцию зависимости. Для примера в папке data/relative_optical_mass лежит простейшая косекансная зависимость, выведенная в приближении плоской Земли. Она может пригодиться для планет-гигантов.
<li>Плотность атмосферы - позволяет создать очень разреженную атмосферу, или вовсе избавиться от нее. Правда, сейчас этот параметр визуально мало на что влияет, ведь экспозиция выставляется по средней яркости, а если нету никакого другого света, кроме света атмосферы (звезд, например), от изменения плотности мало что поменяется. Хотя само солнце станет более белым.
<li>Количество озона и водяных паров - это два газа, пики поглощения которых попадают в видимую область спектра и которые учитиваются по отдельности. Кроме них, в программе фигурирует также поглощение от "прочих газов" - самый правый пик. Их концентрацию пока регулировать нельзя. Но на самом деле эффект от них мизерный. <b>Внимание, сейчас значения этих параметров совсем не отражаются на цвете неба, только на цвете солнца!</b> Несовершенство модели...
<li>Затуманенность (Turbidity) - самый важный параметр. Он определяет, будет ли небо ясным или затянется целиком туманной дымкой. <b>Он может принимать значения от 2 до 32, при других значениях будут получаться малореалистичные изображения</b>
<table>
<tr><td><img src="data/readme_img/turbidity.gif"></td>
<tr><td><div align="center"><b>Видимость (в км) при разных значениях "затуманенности"</b></div></td></tr>
</table>

<li>Графики справа показывают пропускание атмосферы при атмосферной массе 1 и 2. 
</ul>

<h3 align="center">Облака</h3>
<p>Облака, сгенерированные программой, представляют собой стохастический двухмерный черно-белый фрактал - маску.
Строится 2 изображения неба - первое для параметра затуманенность, приведенного во вкладке "параметры атмосферы". Второе - точно такое же, но с затуманенностью, заданной параметром "густота облаков". Затем, по маске они смешиваются в разных пропорциях. 


<h3 align="center">Наблюдатель</h3>
<p>В этих вкладках сейчас наблюдается полнейшая путаница, надеюсь привести все это в порядок. Тем не менее:
<ul>
<li>Азимут и угол места - имеется в виду, куда направлен "взор" ну или оптическая ось фотоаппарата/телескопа, который все снимает. 
<li>Поле зрения - угловое расстояние между самой левой и самой правой точкой изображения.
<li>навигация стрелочками - сейчас почти бесполезная функция. Имеется в виду, что стрелки "влево" и "вправо" на клавиатуре меняют азимут, а "вверх" и "вниз"  - угол места. Очень удобно, если бы отрисовка шла в реальном времени. Сейчас, к сожалению, это не так. Надо осваивать OpenGL и графические ускорители...
<li><b>Построить</b> - самая главная кнопка! Именно при ее нажатии генерится изображение.
</ul>
<h3 align="center">Свойства оптики</h3>
<ul>
<li><b>Доля рассеянного света.</b> Речь идет о рассеянии части света на хрусталике глаза или на линзах фотоаппарата, в результате чего он равномерно засвечивает сетчатку/матрицу целиком. Результатом становится уменьшение контрастности, которое мы подсознательно воспринимаем как присутствие яркого источника где-то на краю поля зрения. Один из эффектов Lens Flare, нужных, чтобы отобразить на экране объекты, яркости которых отличаются в 500 000 раз. Почему-то особенного эффекта я не почувствовал...
<li><b>Макс. углы по горизонтали, сверху и снизу</b>. Если яркий объект укладывается в эти углы, то его наличие будет приниматься во внимание. Иначе он будет просто игнорироваться. Т.е это параметры "бленды", будь это настоящая бленда, или рука, поднятая над глазами или просто лоб и скулы, блокирующие совсем уж косые лучи.
<li><b>Диаметр зрачка</b> - нужен для расчета дифракции. Пока берется лишь простая "гауссова" дифракция, при которой каждая точка превращается в кружочек с радиусом lambda/D и с гауссовым затуханием на концах. Эффект явно есть, но пока не очень реалистично. Пожалуй, лучше здесь оставить 1мм, хотя можно поиграться.
<li><b>Экспокоррекция</b> - очень полезный параметр. Позволяет отрегулировать яркость полученного изображения. Коррекция 1 означает увеличение яркости в 2 раза, 2 - в 4 раза, -1 - уменьшение в 2 раза и т.д. Основное применение - засветить картинку при попадании солнца прямо в объектив. Сейчас при этом получается снимок "против света" - виден только диск солнца практически на темном фоне. Выставив коррекцию 2..4, удается получить более-менее нормальную картину. Опять же, пока здесь все далеко до идеала.
</ul>
<h3 align="center">Рендеринг</h2>
Пока всего один параметр - как регулировать выдержку - по средней яркости или по максимальной. Лучше оставить, как есть.

<h2 align="center">Условия пользования</h2>
<p>Программа распространяется бесплатно. Начиная с v. 0.33, исходные коды можно скачать с <a href="https://github.com/nabbla/Xenosky">https://github.com/nabbla/Xenosky</a>

<h2 align="center">Литература</h2>
<p><b><a name="bib1">[1]</a></b> A Practical Analytic Model for Daylight, A. J. Preetham, Peter Shirley, Brian Smits <a href="http://www.cs.utah.edu/~shirley/papers/sunsky/">http://www.cs.utah.edu/~shirley/papers/sunsky/</a>
</body>
</html>